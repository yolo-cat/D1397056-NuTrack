# NuTrack 應用程式資料結構文件

本文件詳細列出 NuTrack 營養追蹤 iOS 應用程式中所有的資料結構及其關係。

## 核心營養資料模型 (NutritionModels.swift)

### 1. NutritionInfo
基礎營養資訊結構，記錄食物的營養成分。

```swift
struct NutritionInfo {
    let calories: Int     // 卡路里
    let carbs: Int       // 碳水化合物 (公克)
    let protein: Int     // 蛋白質 (公克)
    let fat: Int         // 脂肪 (公克)
}
```

**建構子:**
- `init(calories: Int, carbs: Int, protein: Int, fat: Int)` - 直接指定所有營養成分
- `init(carbsGrams: Int, proteinGrams: Int, fatGrams: Int)` - 根據三大營養素重量自動計算熱量

**用途:** 記錄單一食物或餐點的營養資訊

### 2. MealType
餐點類型列舉，定義一日三餐的分類。

```swift
enum MealType: String, CaseIterable {
    case breakfast = "早餐"
    case lunch = "午餐"
    case dinner = "晚餐"
}
```

**屬性:**
- `icon: String` - 返回對應餐點的系統圖示名稱

**用途:** 分類餐點類型，提供 UI 圖示支援

### 3. MealItem
餐點資訊結構，表示單一餐點項目。

```swift
struct MealItem: Identifiable {
    let id = UUID()
    let name: String           // 餐點名稱
    let type: MealType        // 餐點類型
    let time: String          // 用餐時間
    let nutrition: NutritionInfo  // 營養資訊
}
```

**用途:** 表示具體的餐點項目，包含完整的營養和時間資訊

### 4. DailyGoal
每日營養目標結構，定義使用者的日常營養攝取目標。

```swift
struct DailyGoal {
    let calories: Int    // 熱量目標
    let carbs: Int      // 碳水化合物目標 (公克)
    let protein: Int    // 蛋白質目標 (公克)
    let fat: Int        // 脂肪目標 (公克)
}
```

**靜態屬性:**
- `standard` - 預設的營養目標 (1973 卡路里)

**擴展方法:**
- `personalized(for weight: Double)` - 根據體重創建個人化目標
- `custom(carbs: Int, protein: Int, fat: Int)` - 根據自定義營養素創建目標

**用途:** 設定和追蹤每日營養攝取目標

### 5. NutrientData
營養素資料結構，追蹤單一營養素的攝取進度。

```swift
struct NutrientData {
    var current: Int    // 目前攝取量
    var goal: Int       // 目標攝取量
    var unit: String    // 單位 (通常是 "g")
}
```

**計算屬性:**
- `progress: Double` - 攝取進度 (0.0 - 1.0)
- `percentage: Int` - 攝取百分比

**用途:** 追蹤個別營養素的攝取進度

### 6. NutritionData
主要營養資料結構，整合所有營養追蹤資訊。

```swift
struct NutritionData {
    var caloriesConsumed: Int    // 已攝取熱量
    var caloriesBurned: Int      // 已消耗熱量
    var caloriesGoal: Int        // 熱量目標
    var carbs: NutrientData      // 碳水化合物資料
    var protein: NutrientData    // 蛋白質資料
    var fat: NutrientData        // 脂肪資料
}
```

**計算屬性:**
- `remainingCalories: Int` - 剩餘可攝取熱量
- `calorieProgress: Double` - 熱量攝取進度
- `totalNutrientProgress: Double` - 總營養素攝取平均進度
- `macronutrientCaloriesDistribution` - 三大營養素熱量分佈
- `macronutrientPercentages` - 三大營養素百分比分佈

**用途:** 應用程式的核心資料結構，整合所有營養追蹤功能

## 食物記錄和模擬資料 (MockData.swift)

### 7. FoodLogEntry
今日食物記錄條目，記錄使用者的飲食日誌。

```swift
struct FoodLogEntry: Identifiable {
    let id = UUID()
    let time: String              // 記錄時間
    let meals: [MealItem]?        // 餐點清單 (舊版格式)
    let type: MealType?           // 餐點類型 (舊版格式)
    let nutrition: NutritionInfo? // 營養資訊 (新版格式)
}
```

**建構子:**
- `init(time: String, meals: [MealItem], type: MealType)` - 基於餐點的舊版建構子
- `init(time: String, nutrition: NutritionInfo)` - 直接營養記錄的新版建構子

**計算屬性:**
- `totalCalories: Int` - 總熱量
- `totalCarbs: Int` - 總碳水化合物
- `totalProtein: Int` - 總蛋白質
- `totalFat: Int` - 總脂肪
- `caloriePercentage: Int` - 佔日標熱量的百分比
- `description: String` - 記錄描述

**靜態屬性:**
- `todayEntries` - 今日飲食記錄範例資料

**用途:** 記錄使用者的每日飲食條目

### 8. 模擬資料擴展
為各種資料結構提供測試和開發用的範例資料。

**MealItem 擴展:**
- `mockMeals` - 包含早餐(6項)、午餐(8項)、晚餐(8項)的模擬餐點資料

**NutritionData 擴展:**
- `sample` - 基於模擬餐點計算的範例營養資料

## 使用者管理 (SimpleUserManager.swift)

### 9. SimpleUserManager
使用者狀態管理類別，採用 ObservableObject 模式。

```swift
class SimpleUserManager: ObservableObject {
    @Published var isLoggedIn: Bool = false
    @Published var currentUsername: String = ""
    @Published var isLoading: Bool = false
    @Published var userWeight: Double = 70.0
    @Published var carbsGoal: Double = 210.0
    @Published var proteinGoal: Double = 105.0
    @Published var fatGoal: Double = 63.0
}
```

**私有屬性:**
- `userDefaultsKeys` - UserDefaults 鍵值組合

**主要方法:**
- `checkStoredLogin()` - 檢查已儲存的登入狀態
- `loadUserData()` - 載入用戶資料
- `login(username: String)` - 使用者登入
- `logout()` - 使用者登出
- `quickLogin(username: String)` - 快速登入 (開發用)
- `updateWeight(_ weight: Double)` - 更新用戶體重
- `updateNutritionGoalsBasedOnWeight()` - 根據體重更新營養目標
- `updateNutritionGoals(carbs:protein:fat:)` - 更新營養目標
- `getCurrentNutritionGoals()` - 獲取當前營養目標

**計算屬性:**
- `totalCaloriesGoal: Int` - 總熱量目標

**靜態屬性:**
- `sampleUsers` - 範例使用者清單

**用途:** 管理使用者登入狀態、個人資料和營養目標

## 權重計算工具 (WeightCalculations.swift)

### 10. Double 擴展
為 Double 類型新增體重相關的驗證和格式化功能。

```swift
extension Double {
    var isValidWeight: Bool        // 驗證體重範圍 (30.0-300.0 kg)
    var formattedWeight: String    // 格式化體重顯示
}
```

### 11. WeightBasedNutrition
體重基礎營養計算工具結構。

```swift
struct WeightBasedNutrition {
    // 靜態方法
    static func calculateBaseNutritionGoals(for weight: Double) -> (carbs: Int, protein: Int, fat: Int)
    static func calculateNutrientRanges(for weight: Double) -> (carbsRange: ClosedRange<Double>, proteinRange: ClosedRange<Double>, fatRange: ClosedRange<Double>)
    static func calculateTotalCalories(carbs: Int, protein: Int, fat: Int) -> Int
    static func validateNutrientValues(carbs: Int, protein: Int, fat: Int, for weight: Double) -> Bool
}
```

**計算公式:**
- 碳水化合物: 3g/kg 體重 (範圍: 1-6g/kg)
- 蛋白質: 1.5g/kg 體重 (範圍: 0.8-2.2g/kg)
- 脂肪: 0.9g/kg 體重 (範圍: 0.8-1g/kg)
- 熱量計算: (碳水×4) + (蛋白質×4) + (脂肪×9)

**用途:** 根據使用者體重計算個人化營養目標

## 資料結構關係圖

```
NutritionData (主要資料結構)
├── caloriesConsumed/Burned/Goal
├── carbs: NutrientData
├── protein: NutrientData
└── fat: NutrientData

FoodLogEntry (飲食記錄)
├── meals: [MealItem] (舊版)
│   └── MealItem
│       ├── type: MealType
│       └── nutrition: NutritionInfo
└── nutrition: NutritionInfo (新版)

SimpleUserManager (使用者管理)
├── 使用者狀態 (登入/載入)
├── 個人資料 (體重)
└── 營養目標 (碳水/蛋白質/脂肪)

DailyGoal (每日目標)
├── standard (預設目標)
├── personalized (個人化目標)
└── custom (自定義目標)

WeightBasedNutrition (計算工具)
└── 根據體重計算營養目標
```

## 使用流程

1. **使用者註冊/登入**: `SimpleUserManager` 管理使用者狀態
2. **設定個人資料**: 輸入體重，系統透過 `WeightBasedNutrition` 計算建議營養目標
3. **建立每日目標**: 根據個人資料建立 `DailyGoal`
4. **記錄飲食**: 選擇 `MealItem` 或直接輸入 `NutritionInfo`，建立 `FoodLogEntry`
5. **追蹤進度**: `NutritionData` 整合所有資料，計算攝取進度和剩餘目標
6. **資料持久化**: 透過 `UserDefaults` 儲存使用者設定和偏好

## 技術特色

- **型別安全**: 使用強型別的 Swift 結構和列舉
- **響應式設計**: `SimpleUserManager` 採用 `@Published` 屬性配合 SwiftUI
- **計算屬性**: 大量使用計算屬性提供即時的營養統計
- **擴展性**: 透過擴展為既有類型新增功能
- **資料驗證**: 內建體重和營養數值的驗證邏輯
- **模組化設計**: 清楚分離資料模型、使用者管理和計算邏輯

這個資料結構設計支援完整的營養追蹤功能，同時保持程式碼的可維護性和擴展性。